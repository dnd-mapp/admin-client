# D&D Mapp: Admin Client

The **D&D Mapp: Admin Client** is the web-based administration interface for the D&D Mapp platform.

It’s used to:

- Manage and inspect platform data
- Configure servers and related runtime settings
- Monitor and debug server instances used with D&D Mapp

This is a real application and is primarily intended for administrators of the D&D Mapp platform.

---

## Getting started

> [!NOTE]  
> This application is intended for use within the `dnd-mapp` ecosystem and by authorized administrators only.

### Prerequisites

You will need:

- **Node.js, v24.12.0**
- **pnpm, v10.26.2**
- **[mkcert](https://github.com/FiloSottile/mkcert)** (for local HTTPS certificates)
- (Recommended) [**Mise**](https://mise.jdx.dev/) to manage Node and pnpm versions

Make sure `node`, `pnpm`, and `mkcert` are in your `PATH`.

### Installation

Install dependencies with pnpm:

```bash
pnpm install
```

---

## Local HTTPS configuration

The dev server is configured to serve over **HTTPS by default**. To avoid browser certificate warnings, you need to:

1. Install the local Certificate Authority (CA) provided by `mkcert`.
2. Generate self-signed certificates for the local domain.
3. Map the custom domain to `localhost` in your hosts file.

### 1. Install mkcert

Follow the instructions for your OS.

- **Windows**
    - Install [Chocolatey](https://chocolatey.org/install) (if not already installed).
    - Then:

      ```bash
      choco install mkcert
      ```

- **macOS**
    - Install [Homebrew](https://brew.sh/) (if not already installed).
    - Then:

      ```bash
      brew install mkcert nss
      ```

  `nss` is required if you use Firefox.

- **Linux**
    - Use your distribution’s package manager or download from mkcert’s releases. Example (using Homebrew on Linux):

      ```bash
      brew install mkcert nss
      ```

For detailed and up-to-date installation steps, see the [mkcert documentation](https://github.com/FiloSottile/mkcert?tab=readme-ov-file#installation).

### 2. Install the local CA into your trust store

This step allows your system/browser to trust certificates generated by mkcert.

Run:

```bash
mkcert -install
```

- On **Windows**, this installs a local CA into the Windows certificate store.
- On **macOS**, it installs the CA into the macOS Keychain and (if `nss` is installed) into Firefox’s store.
- On **Linux**, it attempts to integrate with your system’s trust store and browsers (this may vary per distro and desktop environment).

After this step, certificates generated by `mkcert` will be trusted by your system and browsers.

### 3. Generate local certificates

This project provides a script to generate the required certificates:

```bash
pnpm gen:certificates
```

This will typically:

- Create a local key and certificate for the development domain used by the dev server.
- Place them in the location expected by the dev setup.

If the script fails, or you need to regenerate manually, you can use:

```bash
mkcert -cert-file cert.pem -key-file cert-key.pem localhost.admin.dndmapp.dev localhost 127.0.0.1
```

and then adjust the dev server config accordingly if paths differ.

### 4. Update your hosts file

The dev server uses a custom local domain:

```text
localhost.admin.dndmapp.dev
```

You need to map this domain to `127.0.0.1` in your system’s hosts file.

- **Windows**  
  Edit `C:\Windows\System32\drivers\etc\hosts` as Administrator and add:

  ```text
  127.0.0.1  localhost.admin.dndmapp.dev
  ```

- **macOS / Linux**  
  Edit `/etc/hosts` with sudo and add:

  ```text
  127.0.0.1  localhost.admin.dndmapp.dev
  ```

After saving, your browser should resolve `https://localhost.admin.dndmapp.dev` to your local dev server without certificate warnings (once the CA and certificates are set up).

---

## Running the dev server

### HTTPS (default)

Start the dev server with:

```bash
pnpm start
```

Then open the configured HTTPS URL in your browser, for example:

```text
https://localhost.admin.dndmapp.dev:4200
```

The exact port may differ if you change it in `angular.json`.

### HTTP (optional)

If you don’t want HTTPS locally (e.g., for quick testing), you can use the HTTP-specific configuration:

```bash
pnpm start:http
```

Then open:

```text
http://localhost:4200
```

(or whatever port is configured for the `http` configuration).

---

## Building the app

To build a production bundle:

```bash
pnpm build
```

For a development-optimized build (if configured):

```bash
pnpm build:dev
```

The output directory and configuration are driven by `angular.json`.

---

## Running tests

This project uses **Vitest** for unit tests and **Playwright** for end-to-end tests. Playwright requires its browsers to be installed.

### 1. Install browsers for tests

Install the browser(s) required by the unit-test-related tooling (Chromium):

```bash
pnpm test:install-browsers
```

Install all browsers used for E2E tests:

```bash
pnpm e2e:install-browsers
```

Run these again after Playwright version bumps if necessary.

### 2. Unit tests (Vitest)

- Run the unit test suite once:

  ```bash
  pnpm test
  ```

- Run tests in watch / dev mode with a UI:

  ```bash
  pnpm test:dev
  ```

- View coverage reports (served via Vite preview):

  ```bash
  pnpm test:coverage-reports
  ```

  This will serve the coverage report from `./reports/unit-tests` and open it in your browser.

### 3. End-to-end tests (Playwright)

- Run all E2E tests:

  ```bash
  pnpm e2e
  ```

- Run E2E tests in UI mode:

  ```bash
  pnpm e2e:dev
  ```

Make sure your dev server is running (or the app is otherwise available) as expected by `e2e/playwright.config.ts`.

---

## Linting & formatting

This project is set up with:

- **ESLint** (via Angular’s `ng lint`)
- **Stylelint** (for styles, especially SCSS)
- **Prettier** (for formatting)
- **markdownlint** (for Markdown files)

Available commands:

- Run Angular/ESLint linting:

  ```bash
  pnpm lint
  ```

- Run Stylelint on SCSS files:

  ```bash
  pnpm stylelint
  ```

- Lint Markdown files:

  ```bash
  pnpm markdownlint
  ```

- Check formatting with Prettier:

  ```bash
  pnpm format:check
  ```

- Automatically format with Prettier:

  ```bash
  pnpm format:write
  ```

---

## Tooling overview

The dnd-mapp Admin Client is built with:

- **Framework**
    - Angular (version 21)

- **Package manager**
    - `pnpm` (version 10)

- **Linting & formatting**
    - ESLint
    - Prettier
    - Stylelint
    - markdownlint

- **Testing**
    - Vitest (unit tests)
    - Playwright (end-to-end tests in real browsers)

- **Other**
    - `@analogjs`
    - [Mise](https://mise.jdx.dev/) is recommended to keep Node and pnpm versions aligned

See `CONTRIBUTING.md` for details on running linting and formatting checks locally.

---

## Editor setup

To get fast feedback and consistent formatting, it’s recommended to configure your editor to use the project’s Prettier, ESLint, and (where supported) Stylelint settings from `node_modules`.

### WebStorm / IntelliJ IDEA

These instructions apply to JetBrains IDEs with JavaScript/TypeScript support (WebStorm, IntelliJ IDEA Ultimate, etc.).

#### Use project Prettier

1. Open **Settings / Preferences**:
    - Windows/Linux: `File > Settings`
    - macOS: `WebStorm > Preferences`
2. Go to **Languages & Frameworks > JavaScript > Prettier**.
3. Set **Prettier package** to the project’s local installation:
    - Select `./node_modules/prettier` (auto-detected in most cases).
4. Enable:
    - **On code reformat** (`⌘⌥L` / `Ctrl+Alt+L`)
    - **On save** (if available in your version).

#### Use project ESLint

1. Open **Settings / Preferences**.
2. Go to **Languages & Frameworks > JavaScript > Code Quality Tools > ESLint**.
3. Select:
    - **Automatic ESLint configuration** (recommended), or
    - **Manual ESLint configuration** with:
        - **ESLint package**: `./node_modules/eslint`
4. Enable:
    - **Run eslint --fix on save** (if available).

#### Use project Stylelint

1. Install the **Stylelint** plugin if it’s not already installed:
    - **Settings / Preferences > Plugins > Marketplace**, search for “Stylelint” and install.
2. Go to **Languages & Frameworks > Style Sheets > Stylelint**.
3. Enable Stylelint and point it to:
    - **stylelint package**: `./node_modules/stylelint`
4. Optionally enable **Run on save** or on file changes, depending on your IDE version.

---

### Visual Studio Code

The project comes with a couple of recommended extensions. See [.vscode/extensions.json](./.vscode/extensions.json) for details.

#### Recommended workspace settings

The project also includes a recommended workspace config at [.vscode/settings.json](./.vscode/settings.json). You can adjust this to your local preferences, but please don’t commit those changes.

Notes:

- VS Code will automatically use the project-local `prettier`, `eslint`, and `stylelint` binaries from `node_modules` when available.
- If you see conflicts between ESLint and Prettier about formatting rules, ensure that **Prettier** is the only **default formatter** and ESLint is used for linting/fixing (not for formatting).

---

## Docker image

This application can also be run via Docker.

- A dedicated README with Docker-specific instructions (build, configuration, environment variables, and usage) is available at [.docker/README.md](./.docker/README.md).
- The same content (or a subset) is also used as the description on the project’s Docker Hub page for the published image.

If you plan to run the dnd-mapp Admin Client via Docker rather than directly with Node and pnpm, please read [.docker/README.md](./.docker/README.md).

---

## Contributing

Contributions to `dnd-mapp/admin-client` are welcome.

Please read the [Contributing guide](./CONTRIBUTING.md) for details on how to:

- Report issues
- Propose changes
- Submit pull requests

By participating in this project, you also agree to follow our [Code of Conduct](./CODE_OF_CONDUCT.md).

---

## Code of Conduct

This project follows a Code of Conduct to help create a welcoming and productive environment for everyone.

By participating in this repository (creating issues, submitting pull requests, commenting, or any other form of contribution), you agree to uphold this Code of Conduct.

Please read the full [Code of Conduct](./CODE_OF_CONDUCT.md) before contributing.

---

## Status

The dnd-mapp Admin Client is actively maintained and primarily serves administrators of the D&D Mapp platform.

External contributions are welcome, but the roadmap and design decisions are mainly driven by the needs of the D&D Mapp platform and its infrastructure.

---

## License

This project is **not licensed for reuse**.

- The author reserves all rights.
- The code is published on GitHub for transparency and reference only.
- You are **not permitted** to use, copy, modify, or distribute this code in any form, whether for commercial or non-commercial purposes, without prior written permission from the author.

For more info see the [LICENSE](./LICENSE). For permission requests, contact: [mail.dndmapp@gmail.com](mailto:mail.dndmapp@gmail.com)
